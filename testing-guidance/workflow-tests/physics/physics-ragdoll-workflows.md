# Ragdoll Authoring Improvements Workflow Tests

Testing in this area should focus on the new Ragdoll Authoring Improvements.

## General Docs
* [Creating and Simulating a PhysX Ragdoll](https://www.o3de.org/docs/user-guide/visualization/animation/animation-editor/creating-and-simulating-physx-ragdoll/)
* [Animation Editor User Interface](https://www.o3de.org/docs/user-guide/visualization/animation/animation-editor/user-interface/)
* [Setting up a Ragdoll](https://stabilization-22-10--o3deorg.netlify.app/docs/user-guide/visualization/animation/animation-editor/ragdoll/ragdoll-physics-setup/)

## Common Issues to Watch For

Test guidance will sometimes note specific issues to watch for. The common issues below should be watched for through all testing, even if unrelated to the current workflow being tested.
- Issues with the Editor running in the background when Animation Editor is running (for example freezing when saving changes to an actor).
- Wiremesh highlighting/coloration in the Atom Render Window does not change properly when hovered over, or is not updated properly when modified.
- Certain actions not being written to the Action History, and being unaffected by the Undo/Redo actions.
- No warning/save popups in the Animation Editor (for example when an Autosave is performed, or when a Motion Set is mising when attempting to use *Automatic joint limit setup*).

## Workflows

### Area: Ragdoll Authoring Improvements

**Project Requirements**

Any project that has the following Gems enabled:
* An actor (fbx) file set up for Motions (for example *Rin.fbx* supplied by the Motion Matching Gem).
* Multiple motions that work with the actor (Motion Mating Gem contains a *MotionMatching.motionset* for the *Rin.fbx* actor).

**Editor Platforms:**
* Windows
* Linux

**Product:** An actor that is configured to ragdoll that can be placed in a scene.

**Suggested Time Box:** 60 minutes per platform.

| Workflow                                  | Requests           | Things to Watch For |
|-------------------------------------------|--------------------|---------------------|
| **Setup a ragdoll for an actor**          | <ol><li>Open the O3DE Editor.</li> <li> Open the Animation Editor (using varying entry points):</li><ul><li>O3DE Toolbar → Tools → Animation Editor</li><li>Actor Component's Actor asset property field.</li></ul> <li>Make sure that the current Animation Editor layout is set to Physics. Layout can be changed by expanding the dropdown menu in the top right corner of the Animation Editor.</li> <li> Go to File → Open Actor, and select your actor file (for example *Rin.fbx*).</li> <li>In the Skeleton Outliner, add a to the desired bones by doing **Right-Click → Ragdoll → Add to Ragdoll** on each of them. Alternatively, you can select the bones in the Skeleton Outliner, and click the *Add to ragdoll* button in the Ragdoll tab. For example on the *Rin.fbx* you would configure the following bones: <ul><li>*L_wrist_INT*</li><li>*C_head_INT*</li><li>*R_wrist_INT*</li><li>*L_foot_INT*</li><li>*R_foot_INT*</li></ul> </li></ol> | <ul><li>Animation Editor launches.</li> <li>Your actor file is avaliable for selection.</li><li>Animation Editor layout can be changed to Physics.</li><li>Actor bones are listed in the Skeleton Outliner while it is opened in the Animation Editor.</li><li>Selected actor bones can be added to the ragdoll via Skeleton Outliner's context menu.</li><li>Collider can be removed from bones added to the ragdoll.</li></ul>  |
| **Verify Atom Render Window UI clusters** | <ol><li>Click the filter button in the top right corner of the Skeleton Outliner, and check the *Ragdoll joints and colliders* filter for easier navigation.</li><li>In the Skeleton Outliner select a bone that has both a collider, and a joint limit enabled (for example *L_wrist_INT* from the *Rin.fbx*).</li> <li>With the bone still selected deselect the *Has joint limit* property in the Ragdoll pane.</li> <li>In the Skeleton Outliner select a bone, right-click it, and select **Ragdoll → Remove Colliders** from the context menu.</li> <li>Select bones in the Skeleton Outliner that either have both, one of, or no collider, and joint limit enabled.</li><li>In the Skeleton Outliner select a bone that has both a collider, and a joint limit enabled (for example *L_wrist_INT* from the *Rin.fbx*). Select all buttons from both clusters in the Atom Render Window in order. For the *Automatic joint limit setup* button, the Animation Editor layout has to be changed to AnimGraph (from Physics), and your Motion Set (for example *MotionMatching.motionset*) has to be added under the Motion Sets → Motion Set Management by clicking the *Load motion set from file* button. You can enable *Ragdoll Colliders*, and *Ragdoll Joint Limits* under the *eye* button dropdown menu in the Atom Render Window for more visual clarity.</li></ol> | <ul><li>Filters properly apply to relevant bones.</li><li>Two button clusters show up in the top-left corner of the Atom Render Window when relevant bones are selected. First cluster from the top has three buttons used for modifying collider translation, rotation, and dimensions. Second cluster from the top has five buttons used for adjusting joint limits.</li></br>![](images/bone_button_clusters.png) <br><li>Disabling/enabling colliders/*Has joint limit* property hides/shows their relevant button clusters.</li><li>Switching between different bones properly updates button clusters.</li><li>Manipulators that show up in the Atom Renderer Window are functional, and their changes are retained after being deselected.</li><li>Adding a Motion Set allows the *Automatic joint limit setup* button to be used.</li></ul>  |
| **Manipulators** | <ol><li>In the Animation Editor open the Action History, by going to View → Action History. Place the window in a visible, and convenient place (for example dock it under the Skeleton Outliner pane).</li> <li>Modify any bone using any of the manipulators in the Atom Renderer Window (same as in the *Verify Atom Render Window UI clusters* workflow).</li> <li>Modify any bone by changing properties related to the button clusters under the Ragdoll pane (for example *Swing limit Y*, or *Twist upper limit*).</li> <li>Perform Undo/Redo actions on changes made by using Atom Render Window, and modifying properties under the Ragdoll pane. Undo/Redo actions can be performed by using Ctrl+Z/Ctrl+Shift+Z shortcuts, or by selecting Edit → Undo/Edit → Redo.</li></ol> | <ul><li>Action History can be opened.</li><li>Modifications made in the Atom Render Window using the manipulators is saved to the Action History, and is affected by Undo/Redo actions.</li><li>Modifications made in the Ragdoll pane by adjusting properties is saved to the Action History, and is affected by Undo/Redo actions.</li></ul>  |
| **Joint Limit Optimization** | <ol><li>Remove the added Motion Set, by going to the AnimGraph layout → Motion Sets pane → Motion Set Management, right-clicking your Motion Set, and selecting *Remove selected* from the context menu.</li><li>Go back to the Physics layout, select a bone with joint limit enabled in the Skeleton Outliner, and press the *Automatic joint limit setup* button at the bottom of the clusters in the Atom Render Window.</li><li>Add the Motion Set back, by changing the layout to AnimGraph (from Physics), and add your Motion Set (for example *MotionMatching.motionset*) under the Motion Sets → Motion Set Management by clicking the *Load motion set from file* button.</li><li>Go back to the Physics layout, and press the *Automatic joint limit setup* button at the bottom of the clusters in the Atom Render Window.</li></ol> | <ul><li>Motion Sets can be removed, and added in the Animation Editor.</li><li>A message pops up if there is no Motion Set loaded while the user tries to use the *Automatic joint limit setup*.</li><li>*Automatic joint limit setup* properly overwrites any changes made to the joint limit, and roughly matches the expected range of movement.</li><li>Joint limits adjusted by *Automatic joint limit setup* should roughly match the movement given bone could be doing (for example a knee joint should have a cone close to 180 degrees in one direction, and narrow range of movement in the other direction).</li></ul>  |
| **Self-collision Warning** | <ol><li>Make sure that the Ragdoll Collider drawing is enabled under the *eye* button dropdown menu.</li><li>See if there are any bones present with red wiremeshes. For example on the *Rin.fbx* skeleton set up in these workflows, these should be *L_leg_INT*, and *R_leg_INT*. Red coloration of the wiremesh means that two joints **which are not adjecent in the hierarchy** (for example *R_knee_INT* from the *Rin.fbx* bone is adjacent to *R_leg_INT*, and *R_foot_INT*) are colliding with each other. This can be fixed by removing the collision of one of the intersecting bones (select a bone in the Skeleton Outliner, and choose Ragdoll → Remove colliders), or by simply moving/rotating the bones so that they do not intersect, by changing their Offset/Rotation properties. </li> <li>Select a bone, and move/rotate it around by modifying the collider's Offset/Rotation properties under the Ragdoll pane, or using relevant manipulators in the Atom Render Window.</li></ol> | <ul><li>Ragdoll Collider drawing can be enabled, and draws wiremeshes of the bones added to the ragdoll.</li><li>Intersecting non-adjacent in hierarchy bones have red wiremeshes instead of grey.</li><li>Moving/rotating bones around properly updates the wiremesh coloration if an unallowed intersection occurs.</li></ul>  |
| **Picking and hovering** | <ol><li>Select different joints by clicking on their wiremeshes in the Atom Render Window.</li><li>Hover over different bones in the Skeleton Outliner.</li></ol> | <ul><li>Bones can be selected by clicking their wiremeshes in the Atom Render Window.</li><li>Hovering over bones in the Skeleton Outliner highlights them with a bright color in the Atom Render Window.</li><li>If hovering over different bones does not work, please enable/disable the *Line Skeleton* under the *eye* button dropdown in the Atom Render Window.</li></ul>  |
---